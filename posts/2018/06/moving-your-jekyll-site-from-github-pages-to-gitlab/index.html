<!doctype html><html lang=en>
<head>
<meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="ie=edge">
<meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no">
<meta name=author content="Brad Thornborrow ">
<meta name=description content="For the last several months, I&amp;rsquo;ve been pondering the move of this site from GitHub Pages to GitLab. I have several reasons which I won&amp;rsquo;t get into here, but the recent news regarding the acquisition of GitHub by Microsoft gave me the impetus to get this done. I ran into several interesting &amp;ldquo;hiccups&amp;rdquo; during the process, and decided to write this post to help anyone else going down this road.">
<meta name=keywords content=",github,gitlab,jekyll">
<meta name=robots content="noodp">
<meta name=theme-color content>
<link rel=canonical href=/posts/2018/06/moving-your-jekyll-site-from-github-pages-to-gitlab/>
<title>
Moving your Jekyll site from GitHub Pages to GitLab ∣ Brad Thornborrow
</title>
<link href=https://cdnjs.cloudflare.com/ajax/libs/flag-icon-css/3.2.1/css/flag-icon.min.css rel=stylesheet type=text/css>
<link rel=stylesheet href=/main.min.feca676bd2344243429c1be3db7ad89c169586b90da8dd758767ee900ec735ef.css>
<link rel=stylesheet type=text/css href=/css/custom.css>
<link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png>
<link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png>
<link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png>
<link rel=manifest href=/site.webmanifest>
<link rel=mask-icon href=/safari-pinned-tab.svg color>
<link rel="shortcut icon" href=/favicon.ico>
<meta name=msapplication-TileColor content>
<meta name=theme-color content>
<meta itemprop=name content="Moving your Jekyll site from GitHub Pages to GitLab">
<meta itemprop=description content="For the last several months, I&rsquo;ve been pondering the move of this site from GitHub Pages to GitLab. I have several reasons which I won&rsquo;t get into here, but the recent news regarding the acquisition of GitHub by Microsoft gave me the impetus to get this done. I ran into several interesting &ldquo;hiccups&rdquo; during the process, and decided to write this post to help anyone else going down this road."><meta itemprop=datePublished content="2018-06-05T00:00:00+00:00">
<meta itemprop=dateModified content="2018-06-05T00:00:00+00:00">
<meta itemprop=wordCount content="1138"><meta itemprop=image content="/">
<meta itemprop=keywords content="github,gitlab,jekyll,"><meta property="og:title" content="Moving your Jekyll site from GitHub Pages to GitLab">
<meta property="og:description" content="For the last several months, I&rsquo;ve been pondering the move of this site from GitHub Pages to GitLab. I have several reasons which I won&rsquo;t get into here, but the recent news regarding the acquisition of GitHub by Microsoft gave me the impetus to get this done. I ran into several interesting &ldquo;hiccups&rdquo; during the process, and decided to write this post to help anyone else going down this road.">
<meta property="og:type" content="article">
<meta property="og:url" content="/posts/2018/06/moving-your-jekyll-site-from-github-pages-to-gitlab/"><meta property="og:image" content="/"><meta property="article:section" content="posts">
<meta property="article:published_time" content="2018-06-05T00:00:00+00:00">
<meta property="article:modified_time" content="2018-06-05T00:00:00+00:00">
<meta name=twitter:card content="summary_large_image">
<meta name=twitter:image content="/">
<meta name=twitter:title content="Moving your Jekyll site from GitHub Pages to GitLab">
<meta name=twitter:description content="For the last several months, I&rsquo;ve been pondering the move of this site from GitHub Pages to GitLab. I have several reasons which I won&rsquo;t get into here, but the recent news regarding the acquisition of GitHub by Microsoft gave me the impetus to get this done. I ran into several interesting &ldquo;hiccups&rdquo; during the process, and decided to write this post to help anyone else going down this road.">
<meta property="article:published_time" content="2018-06-05 00:00:00 +0000 UTC">
</head>
<body>
<div class=container>
<header class=header>
<span class=header__inner>
<a href=/ style=text-decoration:none>
<div class=logo>
<span class=logo__mark>></span>
<span class=logo__text>hello</span>
<span class=logo__cursor style=background-color:#34fe2e>
</span>
</div>
</a>
<span class=header__right>
<nav class=menu>
<ul class=menu__inner><li><a href=/about/>About</a></li><li><a href=/contact/>Contact</a></li><li><a href=/posts/>Posts</a></li>
</ul>
</nav>
<span class=menu-trigger><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M0 0h24v24H0z" fill="none"/><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/></svg>
</span>
<span class="theme-toggle not-selectable"><svg class="theme-toggler" width="24" height="24" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M22 41c10.4934.0 19-8.5066 19-19C41 11.5066 32.4934 3 22 3 11.5066 3 3 11.5066 3 22s8.5066 19 19 19zM7 22C7 13.7157 13.7157 7 22 7V37C13.7157 37 7 30.2843 7 22z"/></svg></span>
</span>
</span>
</header>
<div class=content>
<main class=post>
<div class=post-info>
<p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-clock"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>
6 minutes
</p>
</div>
<article>
<h1 class=post-title>
<a href=/posts/2018/06/moving-your-jekyll-site-from-github-pages-to-gitlab/>Moving your Jekyll site from GitHub Pages to GitLab</a>
</h1>
<div class=post-content>
<p>For the last several months, I&rsquo;ve been pondering the move of this site from GitHub Pages to GitLab. I have several reasons which I won&rsquo;t get into here, but the recent <a href=https://www.bloomberg.com/news/articles/2018-06-03/microsoft-is-said-to-have-agreed-to-acquire-coding-site-github target=_blank>news</a>
regarding the acquisition of GitHub by Microsoft gave me the impetus to get this done. I ran into several interesting &ldquo;hiccups&rdquo; during the process, and decided to write this post to help anyone else going down this road.</p>
<p>Obviously, the first step is to migrate your site source files from GitHub to GitLab. In my case, I have a local copy of this site <strong>cloned</strong> on my local system, and I used this as the source. For other options I recommend you read the GitLab document <a href=https://docs.gitlab.com/ee/user/project/import/github.html target=_blank>Import your project from GitHub to GitLab</a>
. To migrate this site, my first step was to create a new <strong>empty</strong> project on GitLab named <code>bftsystems.gitlab.io</code>. I then cloned this empty repository to my local system, copied my site source files into the empty project, then pushed the results back to GitLab. Here is an overview of the commands I used locally.</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>cd git

git clone git@gitlab.com:bftsystems/bftsystems.gitlab.io.git

cp -R bftsystems.github.io/* bftsystems.gitlab.io/

cd bftsystems.gitlab.io

git add --all

git commit -am <span style=color:#e6db74>&#34;Initial commit to Gitlab hosting&#34;</span>

git push origin master
</code></pre></div><p>Once your repository has been moved to GitLab, nothing will work immediately and no pages will be built. Unlike GitHub, GitLab uses a CI (continuous integration) configuration file to instruct the GitLab site <em>Runners</em> how to build your site. This process is a little more complex than GitHub, but also more flexible. Primarily, this flexibility is what brought me to GitLab for hosting.</p>
<p>To setup the build process, you must create a file named <code>.gitlab-ci.yml</code> in your repository. The contents of this file will direct GitLab how to build your site. The full documentation on this process can be found in the document <a href=https://about.gitlab.com/2016/04/07/gitlab-pages-setup/ target=_blank>Hosting on GitLab.com with GitHub Pages</a>
. As this site is built using Jekyll, I followed the steps in the document outlining the configuration process specifically for Jekyll.</p>
<p>This is where things get a little interesting. When it comes to building the CI file for Jekyll, the GitLab documentation is somewhat vague, and misses several edge cases. Sadly, I seemed to have run into many of those edge cases. Firstly, you must configure your site to use the correct version of Jekyll. This will not be obvious, as the errors provided by GitLab may be non-intuitive. In my case, the errors I received were related to <code>Liquid syntax errors</code> in several source files. After some digging, I discovered these issues were caused by a Jekyll version mismatch. To resolve this, I confirmed the version of Jekyll I&rsquo;m using locally (<code>bundle exec jekyll --version</code>), and updated the <code>Gemfile</code> in my repository to use this version (more on this later).</p>
<p>Further to the Jekyll issue, you must also ensure any Ruby <em>gems</em> (aka <em>plugins</em>) required by your site are added to your site <code>Gemfile</code> as dependencies. Many dependencies included in GitHub by default are not included by GitLab, which will cause build issues. I also believe this is an issue for many other Jekyll templates which assume they are being hosted on GitHub Pages and will encounter dependency issues when hosted on GitLab. To confirm which <em>gems</em> are required, open your site <code>_config.yml</code> file, and locate the section labelled <code>gems:</code> or <code>plugins:</code> (depending on the Jekyll version). Here is the section from this site as an example.</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#75715e># Plugins (previously gems:)</span>
<span style=color:#f92672>plugins</span>:
  - <span style=color:#ae81ff>jekyll-paginate</span>
  - <span style=color:#ae81ff>jekyll-sitemap</span>
  - <span style=color:#ae81ff>jekyll-gist</span>
  - <span style=color:#ae81ff>jekyll-feed</span>
  - <span style=color:#ae81ff>jemoji</span>
</code></pre></div><p>Using this information and the Jekyll version I confirmed previously, I updated the <code>Gemfile</code> for my site accordingly<sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup>.</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#ae81ff>source &#34;https://rubygems.org&#34;</span>

<span style=color:#ae81ff>gem &#39;jekyll&#39;, &#39;3.6.2&#39;</span>
<span style=color:#ae81ff>gem &#39;jekyll-paginate&#39;</span>
<span style=color:#ae81ff>gem &#39;jekyll-sitemap&#39;</span>
<span style=color:#ae81ff>gem &#39;jekyll-gist&#39;</span>
<span style=color:#ae81ff>gem &#39;jekyll-feed&#39;</span>
<span style=color:#ae81ff>gem &#39;jemoji&#39;</span>
</code></pre></div><p>Interestingly, once these changes were made, I now received page build errors from GitLab regarding <strong>Invalid US-ASCII</strong> characters in several of the CSS files. After further digging through the CSS source files and searching on-line, I discovered GitLab does not support <code>UTF-8</code> by default in their Docker instances. A setting was required in the CI file to enforce this on every build (thanks to <a href=https://gitlab.com/pages/jekyll/issues/9 target=_blank>this</a>
Jekyll issue report for the discovery). Once this additional configuration was added to the CI file, the site built successfully on GitLab (woot!). Here is the final version of the <code>.gitlab-ci.yml</code> file with all the necessary changes for your reference.</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#75715e># requiring the environment of Ruby 2.3.x</span>
<span style=color:#f92672>image</span>: <span style=color:#ae81ff>ruby:2.3</span>

<span style=color:#75715e># add bundle cache to &#39;vendor&#39; for speeding up builds</span>
<span style=color:#f92672>cache</span>:
  <span style=color:#f92672>paths</span>: 
    - <span style=color:#ae81ff>vendor/</span>

<span style=color:#f92672>before_script</span>:
  - <span style=color:#ae81ff>bundle install --path vendor</span>

<span style=color:#75715e># the &#39;pages&#39; job will deploy and build your site to the &#39;public&#39; path</span>
<span style=color:#f92672>pages</span>:
  <span style=color:#f92672>stage</span>: <span style=color:#ae81ff>deploy</span>
  <span style=color:#f92672>script</span>:
    - <span style=color:#ae81ff>bundle exec jekyll build -d public/</span>
  <span style=color:#f92672>variables</span>:
    <span style=color:#f92672>JEKYLL_ENV</span>: <span style=color:#ae81ff>production</span>
    <span style=color:#f92672>LANG</span>: <span style=color:#e6db74>&#34;C.UTF-8&#34;</span>
  <span style=color:#f92672>artifacts</span>:
    <span style=color:#f92672>paths</span>:
      - <span style=color:#ae81ff>public</span>
  <span style=color:#f92672>only</span>:
    - <span style=color:#ae81ff>master</span> <span style=color:#75715e># this job will affect only the &#39;master&#39; branch</span>
</code></pre></div><p>Once the build was finished, the site was immediately available through the GitLab Pages subdomain (eg. <code>https://bftsystems.gitlab.io/</code>). The final step in the process was to update DNS for my domain to use GitLab Pages. Once again, this was a little more complex than with GitHub, as there is no automated <strong>https</strong> integration using Let&rsquo;s Encrypt (which GitHub has added recently). I won&rsquo;t go into the specific details of the process here, as it is well documented in the following articles.</p>
<ul>
<li><a href=https://about.gitlab.com/2016/04/07/gitlab-pages-setup/#custom-domains target=_blank>Hosting on GitLab.com with GitLab Pages</a>
- <strong>Step 4: Add your custom domain</strong> covers the steps to update your DNS records for GitLab Pages</li>
<li><a href=https://about.gitlab.com/2016/04/11/tutorial-securing-your-gitlab-pages-with-tls-and-letsencrypt/ target=_blank>Securing your GitLab Pages with TLS and Let&amp;rsquo;s Encrypt</a>
</li>
<li><a href=https://about.gitlab.com/2017/02/07/setting-up-gitlab-pages-with-cloudflare-certificates/ target=_blank>Setting up GitLab Pages with CloudFlare Certificates</a>
</li>
</ul>
<p>In the end, I added two <code>A</code> records for my domain, one for the <em>apex</em> or <em>root</em> domain, and a second for the <em>www</em> subdomain. I could have used a single <em>wildcard</em> record, but I try to avoid using wildcard DNS records (just a personal preference). I then added both these domains, with their associated SSL certificates under <strong>Settings, Pages</strong>. I found both domains were required to avoid any SSL warnings when using some browsers.</p>
<img src=GitLab_Pages_Settings.jpg alt=GitLab_Pages_Settings class=left style=border-radius:4px;margin-left:1em>
<p>As I&rsquo;ve never used <strong>Let&rsquo;s Encrypt</strong> previously, I went through their process to request new certificates and am currently using them for the site. However, I&rsquo;ll likely switch to <strong>CloudFlare</strong> in future. This will avoid the complexity of automating regular certificate updates when using <strong>Let&rsquo;s Encrypt</strong> (90 day expiry versus 15 years with <strong>CloudFlare</strong>, not a difficult choice).</p>
<p>All in all, I&rsquo;m happy with my new setup and have learned a lot moving to GitLab Pages. As always, I hope you found this post useful, or at least interesting. To contact me or provide feedback, use the <a href=/contact>Contact</a>
page, or message me on <a href=http://twitter.com/bftsystems target=_blank>Twitter</a>
.</p>
<p>Thanks!</p>
<section class=footnotes role=doc-endnotes>
<hr>
<ol>
<li id=fn:1 role=doc-endnote>
<p>One final note, updating these dependencies in my site <code>Gemfile</code> has reduced the site build-time in my local test environment by 50%. I&rsquo;m not sure why this has occurred, but a happy side effect nonetheless.&#160;<a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p>
</li>
</ol>
</section>
</div>
</article>
<hr>
<div class=post-info>
<p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-tag meta-icon"><path d="M20.59 13.41l-7.17 7.17a2 2 0 01-2.83.0L2 12V2h10l8.59 8.59a2 2 0 010 2.82z"/><line x1="7" y1="7" x2="7" y2="7"/></svg>
<span class=tag><a href=/tags/github/>github</a></span>
<span class=tag><a href=/tags/gitlab/>gitlab</a></span>
<span class=tag><a href=/tags/jekyll/>jekyll</a></span>
</p>
<p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file-text"><path d="M14 2H6A2 2 0 004 4v16a2 2 0 002 2h12a2 2 0 002-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><polyline points="10 9 9 9 8 9"/></svg>
1138 Words
</p>
<p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>
2018-06-05 12:00 AM
</p>
</div>
<div class=pagination>
<div class=pagination__title>
<span class=pagination__title-h>Read other posts</span>
<hr>
</div>
<div class=pagination__buttons>
<span class="button previous">
<a href=/posts/2018/06/simple-script-to-monitor-for-website-changes/>
<span class=button__icon>←</span>
<span class=button__text>Simple script to monitor for website changes</span>
</a>
</span>
<span class="button next">
<a href=/posts/2018/05/script-for-exporting-micro.blog-posts-to-jekyll/>
<span class=button__text>Script for Exporting Micro.blog posts to Jekyll</span>
<span class=button__icon>→</span>
</a>
</span>
</div>
</div>
</main>
</div>
<footer class=footer>
<div class=footer__inner>
<div class=footer__content>
<span>&copy; 2021
Brad Thornborrow
<a href=/motd title=motd><svg xmlns="http://www.w3.org/2000/svg" width="22" height="18" viewBox="0 0 20 20" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-left:0;margin-right:.25em"><rect x="3" y="4" width="18" height="15" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></a></span><span><a href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank" rel="noopener">CC BY-NC 4.0</a><a href="/index.xml" target="_blank" title="rss"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 20 20" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-rss"><path d="M4 11a9 9 0 019 9"/><path d="M4 4a16 16 0 0116 16"/><circle cx="5" cy="19" r="1"/></svg></a></span>
</div>
</div>
<div class=footer__inner>
<div class=footer__content>
<span>Powered by <a href=http://gohugo.io>Hugo</a> & <a href=https://themes.gohugo.io/hugo-theme-hello-friend-ng/ rel=nofollow>Hello Friend NG</a></span>
</div>
</div>
</footer>
</div>
<script type=text/javascript src=/bundle.min.599099f1f14b78b657d524b28e10e0c5098e7cd46e9c7aed73d577068a276c3ff1bb234cbf29cb313333e83cf411727b43157c91ce5b809e2ffc81664614608e.js integrity="sha512-WZCZ8fFLeLZX1SSyjhDgxQmOfNRunHrtc9V3BoonbD/xuyNMvynLMTMz6Dz0EXJ7QxV8kc5bgJ4v/IFmRhRgjg=="></script>
</body>
</html>